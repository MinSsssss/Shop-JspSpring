<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sian.mapper.OrderMapper">
 	<insert id="orderInsert">
 		<!-- <selectKey keyProperty="order_no" resultType="Long" order="BEFORE">
			SELECT seq_order_no.nextval FROM DUAL
		</selectKey> -->
 		INSERT INTO tbl_order(order_no,mem_id,receiver_name,
 		receiver_tel,receiver_addr1,order_request_msg)
 		VALUES (seq_order_no.nextval,#{mem_id},
 		#{receiver_name},#{receiver_tel},#{receiver_addr1},
 		#{order_request_msg}
 		)
 	</insert>
 	<insert id="orderDetailInsert">
 		<selectKey keyProperty="de_order_no" resultType="Long" order="BEFORE">
			select NVL(MAX(order_no),1) from tbl_order
		</selectKey>
 		INSERT INTO tbl_order_detail(order_detail_no,de_order_no,
 		product_no,order_qty,sub_total)
 		VALUES (seq_order_detail_no.nextval,#{de_order_no},
 		#{product_no},#{order_qty},#{sub_total}
 		)
 	</insert>
 	
 	<delete id="orderCartDelete" parameterType="Map">
		DELETE FROM tbl_cart
		WHERE product_no=#{product_no} AND mem_id=#{mem_id}
	</delete>
	<select id="getOrderNo" resultType="Long">
 		SELECT MAX(order_no)
 		FROM tbl_order
 		WHERE mem_id = #{mem_id}
 	</select>
</mapper>
